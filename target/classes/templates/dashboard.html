<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ClimbUP Dashboard</title>

  <!-- Bootstrap & Icons CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">

  <!-- Custom CSS -->
  <link rel="stylesheet" th:href="@{/css/dashboard.css}">
</head>
<body>
  
  <!-- Topbar -->
  <div class="topbar d-flex align-items-center px-3 py-2 border-bottom">
    <button class="btn btn-sm me-3" id="toggleSidebarBtn">
      <i class="bi bi-list" style="font-size: 1.5rem;"></i>
    </button>
    <h5 class="mb-0 fw-bold">ClimbUP Dashboard</h5>

    <div class="ms-auto d-flex align-items-center">
      <span class="me-3 text-muted"
            th:text="${#temporals.format(#temporals.createToday(), 'EEEE, MMMM d')}"></span>

      <div class="dropdown">
        <button class="btn btn-sm dropdown-toggle" type="button" data-bs-toggle="dropdown">
          <i class="bi bi-person-circle me-1"></i>
          <span th:text="${username != null ? username : 'User'}"></span>
        </button>
        <ul class="dropdown-menu dropdown-menu-end">
          <li><a class="dropdown-item" th:href="@{/dashboard/profile}"><i class="bi bi-person me-2"></i>Profile</a></li>
          <li><a class="dropdown-item" th:href="@{/dashboard/goals}"><i class="bi bi-bullseye me-2"></i>Goals</a></li>
          <li><a class="dropdown-item" th:href="@{/tasks/all}"><i class="bi bi-list-task me-2"></i>All Tasks</a></li>
          <li><hr class="dropdown-divider"></li>
          <li><a class="dropdown-item text-danger" th:href="@{/logout}"><i class="bi bi-box-arrow-right me-2"></i>Logout</a></li>
        </ul>
      </div>
    </div>
  </div>

  <!-- Wrapper -->
  <div class="wrapper d-flex">
    <!-- Sidebar -->
    <div class="sidebar p-3 border-end" id="sidebar">
      <h4 class="mb-3">Menu</h4>
      <nav class="nav flex-column">
        <a class="nav-link" th:href="@{/dashboard}" th:classappend="${currentPath == '/dashboard'} ? ' active'">
          <i class="bi bi-speedometer2 me-2"></i>Dashboard
        </a>
        <a class="nav-link btn btn-primary text-start mt-2" th:href="@{/tasks/add}" th:classappend="${currentPath == '/tasks/add'} ? ' active'">
          <i class="bi bi-plus-circle me-2"></i> Add Task
        </a>
        <a class="nav-link" th:href="@{/tasks/all}" th:classappend="${currentPath == '/tasks/all'} ? ' active'">
          <i class="bi bi-list-check me-2"></i>All Tasks
        </a>
        <a class="nav-link" th:href="@{/tasks/today}" th:classappend="${currentPath == '/tasks/today'} ? ' active'">
          <i class="bi bi-calendar-day me-2"></i>Today's Tasks
        </a>
        <a class="nav-link" th:href="@{/dashboard/goals}" th:classappend="${currentPath == '/dashboard/goals'} ? ' active'">
          <i class="bi bi-bullseye me-2"></i>Goals
        </a>
        <a class="nav-link" th:href="@{/dashboard/focus-mode}" th:classappend="${currentPath == '/dashboard/focus-mode'} ? ' active'">
          <i class="bi bi-fire me-2"></i>Focus Mode
        </a>
        <a class="nav-link" th:href="@{/dashboard/achievements}" th:classappend="${currentPath == '/dashboard/achievements'} ? ' active'">
          <i class="bi bi-trophy me-2"></i>Achievements
        </a>
        <a class="nav-link" th:href="@{/dashboard/profile}" th:classappend="${currentPath == '/dashboard/profile'} ? ' active'">
          <i class="bi bi-person me-2"></i>Profile
        </a>
      </nav>
    </div>

    <!-- Main Content -->
    <div class="main-content flex-grow-1 p-4" id="main-content">
      <!-- Greeting -->
      <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
          <h2 class="fw-bold mb-1">Welcome back, <span th:text="${username != null ? username : 'User'}"></span> üëã</h2>
          <h5 class="text-muted fs-6">Good <span id="greeting"></span>!</h5>
        </div>
      </div>

      <!-- Daily Motivation -->
      <div class="alert alert-info d-flex align-items-center animate-fade">
        <i class="bi bi-lightbulb me-3" style="font-size: 1.5rem;"></i>
        <div>
          <strong class="d-block mb-1">Daily Motivation</strong>
          <span id="quote" th:text="${quote != null ? quote : 'Success starts with self-discipline.'}"></span>
        </div>
      </div>

      <!-- Stats Row -->
      <div class="row g-4 mb-4" id="statsRow">
        
        <div class="col-md-4 animate-fade">
          <div class="stat-card text-center p-3 border rounded">
            <div class="stat-icon text-success mb-2"><i class="bi bi-fire"></i></div>
            <h5 class="text-muted">Current Streak</h5>
            <h3 id="current-streak" class="stat-value" th:text="${currentStreak != null ? currentStreak : 0}" data-value="${currentStreak != null ? currentStreak : 0}">0</h3>
          </div>
        </div>
        <div class="col-md-4 animate-fade">
          <div class="stat-card text-center p-3 border rounded">
            <div class="stat-icon text-info mb-2"><i class="bi bi-calendar-day"></i></div>
            <h5 class="text-muted">Today‚Äôs Tasks</h5>
            <h3 id="pendingCount" class="stat-value" th:text="${todaysCount != null ? todaysCount : 0}" data-value="${todaysCount != null ? todaysCount : 0}">0</h3>
          </div>
        </div>
      </div>

      <!-- XP / Level Progress -->
      <div class="card mb-4 animate-fade">
        <div class="card-body">
          <h5 class="card-title">Level & XP</h5>
          <div class="progress mb-2" style="height: 25px;">
            <div id="xp-progress" class="progress-bar bg-success" role="progressbar" style="width: 0%">0%</div>
          </div>
          <div class="d-flex justify-content-between">
            <span>Level: <span id="level-number">0</span></span>
            <span>XP: <span id="xp-number">0</span> / <span id="next-level-xp">100</span></span>
          </div>
          <div class="d-flex justify-content-end mt-2">
            <span>Max Streak: <span id="max-streak">0</span></span>
          </div>
        </div>
      </div>

      <!-- Heatmap -->
      <div class="card mb-4 animate-fade">
        <div class="card-body">
          <h5 class="card-title">Activity Heatmap</h5>
		  <div class="heatmap-wrapper">
			<div id="month-labels" class="mb-2"></div>
		  <div class="heatmap-header">
		      <span>Jan</span>
		      <span>Feb</span>
		      <span>Mar</span>
		      <span>Apr</span>
		      <span>May</span>
		      <span>Jun</span>
		      <span>Jul</span>
		      <span>Aug</span>
		      <span>Sep</span>
		      <span>Oct</span>
		      <span>Nov</span>
		      <span>Dec</span>
		  </div>

		  <div id="heatmap-container" class="heatmap-box">
		      <svg id="activityHeatmap"></svg>
		  </div>
		  
		  </div>



          <div class="legend text-center mt-3">
            <span class="day level-1"></span> 1 task
            <span class="day level-2"></span> 2 tasks
            <span class="day level-3"></span> 3 tasks
            <span class="day level-4"></span> 4+ tasks
          </div>
        </div>
      </div>

      <!-- Today's Tasks Table -->
      <div class="card mb-4 animate-fade">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center mb-3">
            <h5 class="card-title mb-0">üå§Ô∏è Today's Tasks</h5>
            <a th:href="@{/tasks/add}" class="btn btn-sm btn-primary">+ Add Task</a>
          </div>
          <p class="text-muted fst-italic mb-3">Stay consistent. Regret is more painful than consistency üí™</p>

          <div th:if="${todaysTasks != null and !todaysTasks.isEmpty()}">
            <table class="table table-hover align-middle">
              <thead class="table-light">
                <tr>
                  <th>Title</th>
                  <th>Description</th>
                  <th>Category</th>
                  <th>Status</th>
                  <th>Due</th>
                  <th>Action</th>
                </tr>
              </thead>
              <tbody>
                <tr th:each="task : ${todaysTasks}">
                  <td th:text="${task.title}">Title</td>
                  <td th:text="${task.description}">Description</td>
                  <td th:text="${task.category}">Category</td>
                  <td>
                    <span th:if="${task.completed}" class="text-success fw-semibold">Done</span>
                    <span th:if="${!task.completed}" class="text-warning fw-semibold">Pending</span>
                  </td>
                  <td th:text="${task.dueDate}">Due Date</td>
                  <td>
                    <button 
                      type="button" 
                      th:if="${!task.completed}" 
                      class="btn btn-sm btn-success mark-done-btn" 
                      th:attr="data-id=${task.id}">
                      Mark Done
                    </button>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>

          <div th:if="${todaysTasks == null or todaysTasks.isEmpty()}">
            <p class="text-muted text-center">No tasks for today! Enjoy your day üéâ</p>
          </div>
        </div>
      </div>

    </div> <!-- main-content -->
  </div> <!-- wrapper -->

  <!-- JS Dependencies -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <!-- Custom JS -->
  <script th:src="@{/js/dashboard.js}"></script>

</body>
</html>
