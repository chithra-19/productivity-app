<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Today's Tasks ‚Äì ClimbUp</title>
    <!-- Bootstrap 5.3.2 -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
</head>

<style>
body {
    font-family: 'Inter', sans-serif;
    background: linear-gradient(135deg, #f0f9ff, #e0f2fe);
    margin: 0;
    padding: 2rem 0;
}

.container {
    max-width: 900px;
    margin: 0 auto;
    background: #fff;
    padding: 2rem 2.5rem;
    border-radius: 15px;
    box-shadow: 0 4px 18px rgba(0,0,0,0.08);
    animation: fadeIn 0.5s ease-in-out;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

.back-arrow {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    font-weight: 600;
    font-size: 16px;
    color: black;
    text-decoration: none;
    margin-bottom: 1rem;
    transition: 0.2s ease-in-out;
}

.back-arrow:hover {
    color: #0056b3;
    transform: translateX(-3px);
}

h2 {
    text-align: center;
    color: #0369a1;
    margin-bottom: 1.5rem;
    font-weight: 600;
}

.actions {
    margin-bottom: 1rem;
}

.actions .btn {
    background: #0284c7;
    color: white;
    padding: 0.5rem 1rem;
    border-radius: 6px;
    text-decoration: none;
    font-weight: 600;
    transition: background 0.2s;
}

.actions .btn:hover {
    background: #0369a1;
}

.actions i.message {
    color: #475569;
    font-style: italic;
    font-size: 0.95rem;
}

table {
    width: 100%;
    border-collapse: collapse;
    border-radius: 10px;
    overflow: hidden;
}

th {
    background: #0284c7;
    color: #fff;
    padding: 0.9rem;
    text-align: left;
    font-weight: 600;
}

td {
    padding: 0.8rem 1rem;
    border-bottom: 1px solid #e2e8f0;
    vertical-align: middle;
    position: relative;
}

tr:hover td {
    background: #f0f9ff;
}

.status-done {
    color: #16a34a;
    font-weight: 600;
}

.status-pending {
    color: #d97706;
    font-weight: 600;
}

.btn-complete {
    padding: 0.35rem 0.7rem;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-size: 0.9rem;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 0.4rem;
    background: #16a34a;
    color: white;
    text-decoration: none;
    text-align: center;
    min-width: 80px;
}

.btn-complete:hover {
    background: #15803d;
}

.empty-state {
    text-align: center;
    padding: 2rem;
    color: #64748b;
    font-size: 1rem;
}
</style>

<body>

    <!-- Back to Dashboard -->
    <a href="/dashboard" class="back-arrow">
        <i class="bi bi-arrow-left-circle"></i> Back to Dashboard
    </a>

    <div class="container">

        <!-- Page Title -->
        <h2>üå§Ô∏è Today's Tasks</h2>

        <!-- Actions -->
        <div class="row actions">
            <div class="col-md-auto mb-2 mb-md-0">
                <a href="/tasks/add" class="btn">+ Add Task</a>
            </div>
            <div class="col">
                <i class="message">Stay consistent. Regret is more painful than consistency üí™</i>
            </div>
        </div>

        <!-- Task Table -->
        <div class="table-responsive">
            <table class="table" th:if="${tasks != null and !tasks.isEmpty()}">
                <thead>
                    <tr>
                        <th><i class="fa-solid fa-list-check"></i> Title</th>
                        <th><i class="fa-regular fa-file-lines"></i> Description</th>
                        <th><i class="fa-solid fa-tags"></i> Category</th>
                        <th><i class="fa-solid fa-signal"></i> Status</th>
                        <th><i class="fa-regular fa-calendar-days"></i> Due</th>
                        <th><i class="fa-solid fa-gears"></i> Action</th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:each="task : ${tasks}">
                        <td th:text="${task.title}">Task Title</td>
                        <td th:text="${task.description}">Task Description</td>
                        <td th:text="${task.category}">Task Category</td>
                        <td>
                            <span th:if="${task.completed}" class="status-done">
                                <i class="fa-solid fa-circle-check icon"></i> Done
                            </span>
                            <span th:if="${!task.completed}" class="status-pending">
                                <i class="fa-solid fa-hourglass-half icon"></i> Pending
                            </span>
                        </td>
                        <td>
                            <i class="fa-regular fa-calendar-days icon"></i>
                            <span th:text="${task.dueDate} ?: '-'">Due Date</span>
                        </td>
                        <td>
                            <button th:if="!${task.completed}"
                                    class="btn-complete mark-done"
                                    th:data-id="${task.id}">
                                <i class="fa-solid fa-check"></i> Mark Done
                            </button>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Empty State -->
        <div th:if="${tasks == null or tasks.isEmpty()}" class="empty-state">
            <i class="fa-regular fa-face-smile-beam fa-2x"></i>
            <p>No tasks for today! Enjoy your day üéâ</p>
        </div>
    </div>
</body>

<script>
document.querySelectorAll('.mark-done').forEach(btn => {
    btn.addEventListener('click', async function () {
        const taskId = this.dataset.id;

        try {
            const res = await fetch(`/tasks/complete/${taskId}`, {
                method: "POST",
                headers: { 'Content-Type': 'application/json' }
            });

            const data = await res.json();

            if (data.error) {
                alert(data.error);
                return;
            }

            const scoreEl = document.getElementById("score");
            const streakEl = document.getElementById("streak");
            const pendingEl = document.getElementById("pending");
            if (scoreEl) scoreEl.innerText = data.score;
            if (streakEl) streakEl.innerText = data.streak;
            if (pendingEl) pendingEl.innerText = data.pendingCount;

            const row = btn.closest('tr');
            row.style.transition = "opacity 0.5s";
            row.style.opacity = 0;
            setTimeout(() => row.remove(), 500);

        } catch (err) {
            console.error(err);
            alert("Something went wrong!");
        }
    });
});
</script>

</html>