<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Today's Tasks ‚Äì ClimbUp</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #f0f9ff, #e0f2fe);
            margin: 0;
            padding: 2rem 0;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: #fff;
            padding: 2rem 2.5rem;
            border-radius: 15px;
            box-shadow: 0 4px 18px rgba(0,0,0,0.08);
            animation: fadeIn 0.5s ease-in-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        h2 {
            text-align: center;
            color: #0369a1;
            margin-bottom: 1.5rem;
            font-weight: 600;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            border-radius: 10px;
            overflow: hidden;
        }

        th {
            background: #0284c7;
            color: #fff;
            padding: 0.9rem;
            text-align: left;
            font-weight: 600;
        }

        td {
            padding: 0.8rem 1rem;
            border-bottom: 1px solid #e2e8f0;
            vertical-align: middle;
        }

        tr:hover td {
            background: #f0f9ff;
        }

        .status-done {
            color: #16a34a;
            font-weight: 600;
        }

        .status-pending {
            color: #d97706;
            font-weight: 600;
        }


        .btn {
            padding: 0.35rem 0.7rem;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            display: inline-flex;
            align-items: center;
            gap: 0.4rem;
            transition: all 0.3s ease;
        }

        .btn-complete {
            background: #16a34a;
            color: #fff;
        }

        .btn-complete:hover {
            background: #15803d;
            transform: scale(1.05);
        }

        .icon {
            margin-right: 0.25rem;
        }

        .empty-state {
            text-align: center;
            padding: 2rem;
            color: #64748b;
            font-size: 1rem;
        }
        
      
    </style>
</head>
<body>
<div class="container">
    <h2>üå§Ô∏è Today's Tasks</h2>
    <div class="actions" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
<button onclick="openAddTaskPopup()" 
        style="background: #0284c7; color: white; border: none; padding: 0.5rem 1rem;
               border-radius: 6px; font-weight: 600; cursor: pointer; transition: background 0.2s;">
  + Add Task
</button>

<!-- üîπ Modal Container -->
<div id="addTaskPopup" 
     style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5); justify-content: center; align-items: center; z-index: 999;">
  <div style="background: white; width: 700px; height: 500px; border-radius: 10px; overflow: hidden;
              box-shadow: 0 4px 15px rgba(0,0,0,0.3); position: relative;">
    
    <!-- Close Button -->
    <button onclick="closeAddTaskPopup()" 
            style="position: absolute; top: 10px; right: 15px; background: transparent; border: none;
                   font-size: 1.2rem; cursor: pointer;">‚úñ</button>

    <!-- The Add Task Page loaded here -->
    <iframe id="addTaskFrame" src="" 
            style="width: 100%; height: 100%; border: none; border-radius: 10px;"></iframe>
  </div>
</div>
    <span style="font-size: 1.0rem; color: #475569;">
        <i>   Stay consistent. Regret is more painful than consistency üí™</i>
    </span>
</div>
    
   
    <table th:if="${tasks != null and !tasks.isEmpty()}">
     
       <thead>
	<tr>
    <th><i class="fa-solid fa-list-check"></i> Title</th>
    <th><i class="fa-regular fa-file-lines"></i> Description</th>
    <th><i class="fa-solid fa-tags"></i> Category</th>
    <th><i class="fa-solid fa-signal"></i> Status</th>
    <th><i class="fa-regular fa-calendar-days"></i> Due</th>
    <th><i class="fa-solid fa-gears"></i> Action</th>
</tr>
</thead>
<tbody>
<tr th:each="task : ${tasks}" th:classappend="${task.completed} ? 'task-done-row' : ''">
    <td th:text="${task.title}">Task Title</td>
    <td th:text="${task.description}">Task Description</td>
    <td th:text="${task.category}">Task Category</td>
    <td>
        <span th:if="${task.completed}" class="status-done">
            <i class="fa-solid fa-circle-check icon"></i> Done
        </span>
        <span th:if="${!task.completed}" class="status-pending">
            <i class="fa-solid fa-hourglass-half icon"></i> Pending
        </span>
    </td>
    <td>
        <i class="fa-regular fa-calendar-days icon"></i>
        <span th:text="${task.dueDate} ?: '-'">Due Date</span>
    </td>
    <td>
        <button th:if="!${task.completed}"
                th:onclick="'completeTask(' + ${task.id} + ', event)'"
                class="btn btn-complete">
            <i class="fa-solid fa-check"></i> Mark Done
        </button>
    </td>
</tr>
</tbody>
       
    </table>

    <div th:if="${tasks == null or tasks.isEmpty()}" class="empty-state">
        <i class="fa-regular fa-face-smile-beam fa-2x"></i>
        <p>No tasks for today! Enjoy your day üéâ</p>
    </div>
</div>

		<!-- Add Task Modal -->
<div id="addTaskModal" 
     style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.4); justify-content: center; align-items: center; z-index: 999;">
    <div style="background: white; padding: 1.5rem; border-radius: 8px; width: 350px; box-shadow: 0 4px 12px rgba(0,0,0,0.2);">
        <h3 style="margin-bottom: 1rem;">Add New Task</h3>
        <form id="addTaskForm">
            <input type="text" name="title" placeholder="Title" required 
                   style="width: 100%; margin-bottom: 0.75rem; padding: 0.5rem; border: 1px solid #ccc; border-radius: 5px;">
            <textarea name="description" placeholder="Description" rows="3" 
                      style="width: 100%; margin-bottom: 0.75rem; padding: 0.5rem; border: 1px solid #ccc; border-radius: 5px;"></textarea>
            <input type="date" name="dueDate" 
                   style="width: 100%; margin-bottom: 0.75rem; padding: 0.5rem; border: 1px solid #ccc; border-radius: 5px;">

            <div style="display: flex; justify-content: flex-end; gap: 0.5rem;">
                <button type="button" onclick="closeAddTaskForm()" 
                        style="background: #e2e8f0; border: none; padding: 0.5rem 1rem; border-radius: 5px; cursor: pointer;">
                    Cancel
                </button>
                <button type="submit" 
                        style="background: #16a34a; color: white; border: none; padding: 0.5rem 1rem; border-radius: 5px; cursor: pointer;">
                    Add
                </button>
            </div>
        </form>
    </div>
</div>
		

<script>
function completeTask(taskId, event) {
    fetch('/tasks/complete/' + taskId, { method: 'POST' })
    .then(response => {
        if (response.ok) {
            const row = event.target.closest('tr');
            row.querySelector('.status-pending').innerHTML =
                '<i class="fa-solid fa-circle-check icon"></i> Done';
            row.querySelector('.status-pending').className = 'status-done';
            event.target.remove(); // remove button
        } else {
            console.error('Failed to complete task');
        }
    })
    .catch(err => console.error('Error completing task:', err));
}

    
function openAddTaskPopup() {
  const popup = document.getElementById("addTaskPopup");
  const frame = document.getElementById("addTaskFrame");
  frame.src = "/tasks/add"; // your add-task.html endpoint
  popup.style.display = "flex";
}

function closeAddTaskPopup() {
  const popup = document.getElementById("addTaskPopup");
  popup.style.display = "none";
  document.getElementById("addTaskFrame").src = ""; // clear frame when closing
}
document.getElementById('addTaskForm').addEventListener('submit', function(event) {
    event.preventDefault();

    const formData = new FormData(this);
    const task = Object.fromEntries(formData.entries());

    fetch('/tasks/add', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(task)
    })
    .then(response => {
        if (response.ok) {
            closeAddTaskForm();
            location.reload(); // silently refresh
        } else {
            console.error('Failed to add task');
        }
    })
    .catch(err => console.error('Error adding task:', err));
});
    
</script>
</body>
</html>
